<!DOCTYPE html>
<html>
<head>
  <title>Database Test</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Database Column Test</h1>
  <button onclick="testColumns()">Test Columns</button>
  <button onclick="testSave()">Test Save</button>
  <pre id="output"></pre>

  <script>
    // Replace these with your actual values from .env
    const SUPABASE_URL = 'YOUR_SUPABASE_URL';
    const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const output = document.getElementById('output');

    async function testColumns() {
      output.textContent = 'Testing columns...\n';
      
      try {
        const { data, error } = await supabase
          .from('admin_settings')
          .select('id, require_email_verification, verification_code_length, verification_code_expiry_minutes')
          .eq('id', 1)
          .maybeSingle();
        
        if (error) {
          output.textContent += 'ERROR: ' + JSON.stringify(error, null, 2);
        } else {
          output.textContent += 'SUCCESS:\n' + JSON.stringify(data, null, 2);
        }
      } catch (err) {
        output.textContent += 'EXCEPTION: ' + err.message;
      }
    }

    async function testSave() {
      output.textContent = 'Testing save...\n';
      
      try {
        const { data, error } = await supabase
          .from('admin_settings')
          .upsert({
            id: 1,
            require_email_verification: true,
            verification_code_length: 8,
            verification_code_expiry_minutes: 30
          })
          .select();
        
        if (error) {
          output.textContent += 'ERROR: ' + JSON.stringify(error, null, 2);
        } else {
          output.textContent += 'SUCCESS:\n' + JSON.stringify(data, null, 2);
          output.textContent += '\n\nNow re-reading to verify...';
          await testColumns();
        }
      } catch (err) {
        output.textContent += 'EXCEPTION: ' + err.message;
      }
    }
  </script>
</body>
</html>
